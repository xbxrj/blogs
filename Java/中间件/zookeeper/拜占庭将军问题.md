 # 拜占庭将军问题
 拜占庭问题，为什么只有leader发起投票。每个人都可以发投票，没有投票都要结合所有人接受情况判断结果，最后还要结合所有投票结果判断最终执行动作。浪费以及麻烦，所以选leader

## 问题描述
拜占庭派出7位将军，去进攻敌对国家。7位将军地理位置相隔较远，只能通过信使交换信息。观察敌对国家情况后，制定共同行动计划。7位将军中存在叛徒，会干扰忠诚将军的判断（和现实中分布式网络环境十分相似，怎么保持数据一致性）。问题来了，怎么保持忠诚将军正确的一致行动？
## 问题分析
上面问题拆解下来就是下面这两点要求：
1. 所有忠诚将军决定行动计划
2. 叛徒将军不能使忠诚将军采取一个坏计划
*这里的正确比较粗暴，人数多的决定就认为是正确的，当忠诚将军进攻和撤退平票的时候，这时的进攻或者撤退都不算坏计划*
一个目前我们唯一能知道的方法：
每个将军通过信使将他的信息广播给每个将军，将军们根据这个信息去判断出行动计划。及协议满足如下两个条件
* 条件1: 每一个忠诚的将军必须获得相同的信息v(1),…,v(n)
* 条件2: 如果第i个将军是忠诚的，那么他所发送的值必须被每个忠诚的将军用作v(i)的值
但因为叛徒的存在，所有条件1不能满足，变化为条件1`
* 条件1`:每一个忠诚的将军使用的v(i)值相同
这样只要解决了下面这个问题，所有忠诚将军最终使用的信息v(1),…,v(n)就是相同的了。
```
问题：一个将军发送信息给其他将军，如果这个将军是忠诚，所有忠诚将军使用的就是的就是这个信息，如果这个将军是叛徒，所有忠诚最后使用的信息是相同的。
```
为了方便描述，Lamport在论文中将这个问题的描述最终变化为，主将给副将发送信息的问题。
```
最终只需所有将军执行一个协议（算法），这个协议可以解决如下问题，那所有的问题都解决了：
IC1.所有忠诚的副将遵守相同的命令。 
IC2.如果主将是忠诚的，那么每个忠诚的副将都服从他发出的命令。
```
## 口头协议
口头协议防止主将叛徒不发送信息，会设置默认行动。
### 不可能的结果 （证明的不够准备）
如果将军们只能发出口头信息，那么除非超过三分之二的将军忠诚，否则任何解决办法都不会起作用。口头消息是一个内容完全受到发件人控制的消息，所以一个叛国的发件人可以发送任何可能的消息。及口头协议只可以解决超过3m个将军（3m+1）的问题,m表示最多叛徒数。3个将军中，有一个叛徒的时候这个问题就是无解的。
每个副将获取命令的过程：
1. 接收主将命令
2. 询问其他副将在步骤1的时候接受的命令是什么
证明3m的时候无解：
主将|叛徒，副将1、副将2|忠诚。
步骤1的时候，忠诚副将1收到命令进攻，忠诚副将2收到命令撤退。步骤2的时候忠诚副将1、忠诚副将2收到的都是一个进攻、一个撤退，则无法决策

### 口头协议的解
#### 口头协议定义
```
A1:每个发送的信息都会被正确的传输
A2:信息的接受者知道谁是消息发送者
A3:信息的缺席可以被检查出
```
目的：A1、A2防止叛徒可以干扰两两将军间的通信。A3防止叛徒不发送信息，阻止计划。必须有默认计划，缺席的信息，使用默认计划替代。

#### 口头协议算法
**majority函数：**
一组元素（v1，v2 ... vn）半数以上值为v，则majority(v1，v2 ... vn)=v
对于majority(v1,v2…vn)有两种自然的选择：
1.如果存在出现半数以上的元素，它的值就是它，否则值为默认计划。 
2.vi的中位数，假设他们是一组有序集合。
**口头消息(Oral Message简称OM)算法OM(m)**

